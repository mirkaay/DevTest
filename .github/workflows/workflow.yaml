name: 'CI'

on:
   pull_request:
    branches:
      - master
  
         
jobs:
  test:
       runs-on: ubuntu-latest
       env:
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
       steps:
       - name: Name of the author of PR
         run: |
          echo "$PR_AUTHOR is requesting merge to master"
         shell: bash

  setup:
     name: Setup, Build, Publish, and Deploy
     runs-on: ubuntu-latest   
     env:
      PROJECT_ID: ${{ secrets.PUBSUB_PROJECT }}
      GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
      GOOGLE_APPLICATION_CREDENTIALS: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}     
     defaults:
       run:
        shell: bash

     steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up gcloud Cloud SDK environment
        uses: google-github-actions/setup-gcloud@v0.2.0
        with:
          service_account_key: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS }}
          project_id: ${{ secrets.PUBSUB_PROJECT }}
          export_default_credentials: true
          
      - run: |-
         gcloud pubsub topics publish notifications. --message "${{ github.event.pull_request.user.login }} is requesting merge to master"
